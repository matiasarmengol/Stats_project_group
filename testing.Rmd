---
title: "report"
author: "Adithya Kumar"
date: "2025-04-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(dplyr)
library(ggplot2)
library(reshape2)
```

### Import Dataset
```{r import_data, include=FALSE}
SCS_demand_modelling <- read_csv("Project02/SCS_demand_modelling.csv")
SCS_hourly_temp <- read_csv("Project02/SCS_demand_modelling.csv")
```
### Clean Data
```{r Clean data, include=FALSE}
#CLEANING - prep for M0 model

#select only involved covariates and output variable
vars <- c('Y'='demand_gross', 'Date', 'Wind'='wind', 'Solar'='solar_S', 'Temp'='temp', 'Day_Index'='wdayindex', 'Month_Index'='monthindex')
selected <- select(SCS_demand_modelling, vars)

selected <- selected |> 
  #remove any NAs, there arent any tho
  filter(complete.cases(selected)) |> 
  mutate("Cos_Day" = cos(Day_Index)) |> 
  mutate("Cos_Month" = cos(Month_Index))

View(selected)

```

```{r Baseline-model, include=FALSE}
#Create baseline model
Baseline_model_M0 <- lm(Y ~ Wind + Solar + Temp + Day_Index + Month_Index, data = selected)

# Display model summary
summary(Baseline_model_M0)

#Diagnostic plots
par(mfrow = c(2, 2))
plot(Baseline_model_M0)

```
### Correlation Plots
```{r Correlation-plots, include=FALSE}

numeric_vars <- SCS_demand_modelling %>%
  select(-1, -Date)

#Correlation matrix
cor_matrix <- cor(numeric_vars, use = "pairwise.complete.obs")

# Create a more readable table with rounded values
cor_table <- round(cor_matrix, 3)
print(cor_table)

# Reshape the correlation matrix for ggplot
cor_data <- melt(cor_matrix)

# Create heatmap with ggplot2
heatmap <- ggplot(data = cor_data, aes(x = Var1, y = Var2, fill = value)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                        midpoint = 0, limit = c(-1,1), name = "Correlation") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust = 1)) +
  coord_fixed() +
  geom_text(aes(label = round(value, 2)), size = 3) +
  labs(title = "Correlation Matrix for Demand Variables",
       x = "", y = "")
print(heatmap)

#Specific correlations for gross demand
demand_correlations <- cor_matrix[, "demand_gross"]
demand_correlations <- sort(demand_correlations, decreasing = TRUE)
print(demand_correlations)

# Reset plot layout
par(mfrow = c(1, 1))

# Monthly patterns in demand
SCS_demand_modelling %>%
  group_by(monthindex) %>%
  summarize(avg_demand = mean(demand_gross, na.rm = TRUE)) %>%
  ggplot(aes(x = monthindex, y = avg_demand)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  theme_minimal() +
  labs(title = "Average Demand by Month",
       x = "Month Index", y = "Average Demand")

# Day of week patterns in demand
SCS_demand_modelling %>%
  group_by(wdayindex) %>%
  summarize(avg_demand = mean(demand_gross, na.rm = TRUE)) %>%
  ggplot(aes(x = wdayindex, y = avg_demand)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  theme_minimal() +
  labs(title = "Average Demand by Day of Week",
       x = "Day of Week Index", y = "Average Demand")

# Relationship between temperature and demand
ggplot(SCS_demand_modelling, aes(x = temp, y = demand_gross)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "loess", color = "red") +
  theme_minimal() +
  labs(title = "Relationship Between Temperature and Demand",
       x = "Temperature", y = "Gross Demand")

# Reset plot layout
par(mfrow = c(1, 1))

# Add sine and cosine transformations for cyclic temporal features
# For month of the year (periods of 12 months)
demand_data <- SCS_demand_modelling %>%
  mutate(
    month_sin = sin(2 * pi * monthindex / 12),
    month_cos = cos(2 * pi * monthindex / 12),
    wday_sin = sin(2 * pi * wdayindex / 7),
    wday_cos = cos(2 * pi * wdayindex / 7)
  )

# Recompute correlation matrix with new cyclic features
numeric_vars_with_cyclic <- demand_data %>%
  select(-1, -Date)

cor_matrix_cyclic <- cor(numeric_vars_with_cyclic, use = "pairwise.complete.obs")

# Create a more readable table with rounded values
cor_table_cyclic <- round(cor_matrix_cyclic, 3)
print(cor_table_cyclic)

# Plot correlations of cyclic features with demand
cyclic_vars <- c("month_sin", "month_cos", "wday_sin", "wday_cos")
cyclic_cors <- cor_matrix_cyclic[cyclic_vars, "demand_gross"]
print("Correlations of cyclic features with demand_gross:")
print(cyclic_cors)

# Visualize monthly patterns with sine/cosine transformation
p1 <- ggplot(demand_data, aes(x = month_sin, y = demand_gross)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "loess", color = "red") +
  theme_minimal() +
  labs(title = "Demand vs Month (Sine)",
       x = "Month (sin transform)", y = "Gross Demand")

p2 <- ggplot(demand_data, aes(x = month_cos, y = demand_gross)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "loess", color = "blue") +
  theme_minimal() +
  labs(title = "Demand vs Month (Cosine)",
       x = "Month (cos transform)", y = "Gross Demand")

# Visualize day of week patterns with sine/cosine transformation
p3 <- ggplot(demand_data, aes(x = wday_sin, y = demand_gross)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "loess", color = "red") +
  theme_minimal() +
  labs(title = "Demand vs Day of Week (Sine)",
       x = "Day of Week (sin transform)", y = "Gross Demand")

p4 <- ggplot(demand_data, aes(x = wday_cos, y = demand_gross)) +
  geom_point(alpha = 0.3) +
  geom_smooth(method = "loess", color = "blue") +
  theme_minimal() +
  labs(title = "Demand vs Day of Week (Cosine)",
       x = "Day of Week (cos transform)", y = "Gross Demand")

```

```{r Cross-Validation}

```

```{r M1, include=FALSE}
#first attempt at a new model - using cos of day and month instead. We expect 
#a cyclic relationship as the year progresses so we use the cosine of our time
#variables here to see if it better fits the data.

#initialise M1
Model_M1 <- lm(Y ~ Wind + Solar + Temp + Cos_Day + Cos_Month, data = selected)

#summarise
summary(Model_M1)

#diagnostic plots
par(mfrow = c(2,2))
plot(Model_M1)
```

```{r demand-time models}
# Convert Date column to Date format
SCS_demand_modelling <- SCS_demand_modelling %>%
  mutate(Date = as.Date(Date, format="%Y-%m-%d"))

# First Plot: Daily Gross Demand vs. Date
ggplot(SCS_demand_modelling, aes(x = Date, y = `demand_gross`)) +
  geom_point(alpha = 0.5) +
  labs(title = "Daily Gross Demand vs. Date",
       x = "Date", y = "Gross Demand (MW)") +
  theme_minimal()

# Aggregate data for monthly average
demand_monthly <- SCS_demand_modelling %>%
  group_by(year, monthindex) %>%
  summarise(avg_demand = mean(`demand_gross`, na.rm = TRUE)) %>%
  mutate(month = as.Date(paste(year, monthindex + 1, "01", sep = "-")))

# Second Plot: Monthly Average Gross Demand vs. Month
ggplot(demand_monthly, aes(x = month, y = avg_demand)) +
  geom_point(color = "blue") +
  labs(title = "Monthly Average Gross Demand vs. Month",
       x = "Month", y = "Average Gross Demand (MW)") +
  theme_minimal()

# Aggregate data for yearly average
demand_yearly <- SCS_demand_modelling %>%
  group_by(year) %>%
  summarise(avg_demand = mean(`demand_gross`, na.rm = TRUE))

# Third Plot: Yearly Average Gross Demand vs. Year
ggplot(demand_yearly, aes(x = year, y = avg_demand)) +
  geom_point(color = "red") +
  labs(title = "Yearly Average Gross Demand vs. Year",
       x = "Year", y = "Average Gross Demand (MW)") +
  theme_minimal()
```


